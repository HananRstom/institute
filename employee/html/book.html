<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <title>book</title>
  </head>
  <script>
    function updateA() {
      $(document).on("submit", "#show", function (e) {
        e.preventDefault();

        $.ajax({
          url: $(this).attr("action"),
          type: $(this).attr("method"),
          data: $(this).serialize(),
          success: async function (html) {
            let request = async () => {
              const response = await fetch("http://localhost:8083/showBook");

              const data = await response.json();
              let s = "";
              if (data.error) {
                s = " you must put id";
              } else {
                let lengt = data.result[0].books.length;

                document.getElementById("div").innerHTML = s;

                let checkboxesContainer = document.getElementById(
                  "checkboxes-container"
                );

                checkboxesContainer.innerHTML = "";

                for (let i = 0; i < lengt; i++) {
                  let checkbox = document.createElement("input");
                  checkbox.type = "checkbox";
                  checkbox.name = "book[]";
                  checkbox.value = data.result[0].books[i];

                  let label = document.createElement("label");
                  label.innerHTML = data.result[0].books[i];

                  checkboxesContainer.appendChild(checkbox);
                  checkboxesContainer.appendChild(label);
                  checkboxesContainer.appendChild(document.createElement("br"));
                }
                $("#conf").show();
              }
            };
            await request();
          },
        });
      });
    }

    $(document).ready(async function () {
      await updateA();
      $("#conf").hide();
    });
  </script>

  <body>
    <form action="/editBook" method="post" id="show">
      <label for="id">book id: </label>
      <input type="text" name="bookId" id="id" />

      <div id="div"></div>
      

      <input type="submit" value="submit" />
    </form>
    <form action="/delConf" method="post">
      <div id="checkboxes-container"></div>
      <input type="submit" value="confirm" id="conf" />
    </form>
  </body>
</html>
